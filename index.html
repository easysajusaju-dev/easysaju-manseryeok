<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나만의 만세력</title>
    <!-- 디자인 코드 (스타일) -->
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 15px; background-color: #f9f9f9; }
        h1 { text-align: center; color: #333; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 95%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        button { width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        #result { margin-top: 20px; padding: 15px; background-color: #fff; border: 1px solid #ddd; border-radius: 4px; white-space: pre-wrap; font-family: 'Courier New', Courier, monospace; }
        #saju-result { font-size: 1.8em; font-weight: bold; text-align: center; letter-spacing: 0.2em; margin-bottom: 10px; }
        #daeun-result { font-size: 1.1em; line-height: 1.6; }
    </style>
</head>
<body>
    <h1>나만의 만세력</h1>

    <div class="input-group">
        <label for="birthdate">생년월일</label>
        <input type="date" id="birthdate" value="1990-01-01">
    </div>
    <div class="input-group">
        <label for="birthtime">태어난 시</label>
        <input type="time" id="birthtime" value="12:00">
    </div>
    <button id="calculate-btn">사주 보기</button>

    <div id="result" style="display:none;">
        <div id="saju-result"></div>
        <div id="daeun-result"></div>
    </div>

    <!-- 1. 모든 엔진 부품(코드)들을 미리 불러옵니다 -->
    <script type="module">
        window.BIKUL_MANSERYEOK = {};
        const modules = [
            './src/utils/ganji-util.js',
            './src/utils/si-util.js',
            './src/constants/ganji.js',
            './src/constants/hyeong-chung-pa-hae.js',
            './src/constants/jijanggan.js',
            './src/constants/special-sin-sal.js',
            './src/models/Cheongan.js',
            './src/models/Jiji.js',
            './src/models/Ganji.js',
            './src/models/SinSal.js',
            './src/models/Saju.js',
            './src/models/Manseryeok.js'
        ];
        
        for (const path of modules) {
            try {
                const module = await import(path);
                for (const key in module) {
                    window.BIKUL_MANSERYEOK[key] = module[key];
                }
            } catch (e) {
                console.error(`모듈 로딩 실패: ${path}`, e);
            }
        }
    </script>
    
    <!-- 2. 만세력 계산기 작동 코드 -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dateInput = document.getElementById('birthdate');
            const timeInput = document.getElementById('birthtime');
            const calculateBtn = document.getElementById('calculate-btn');
            const resultDiv = document.getElementById('result');
            const sajuResultDiv = document.getElementById('saju-result');
            const daeunResultDiv = document.getElementById('daeun-result');

            calculateBtn.addEventListener('click', () => {
                if (!window.BIKUL_MANSERYEOK || !window.BIKUL_MANSERYEOK.Manseryeok) {
                    alert('만세력 엔진 로딩에 실패했습니다. 잠시 후 다시 시도해주세요.');
                    return;
                }

                const dateValue = dateInput.value;
                const timeValue = timeInput.value;

                if (!dateValue || !timeValue) {
                    alert('생년월일과 시간을 모두 입력해주세요.');
                    return;
                }

                const fullDateTime = new Date(`${dateValue}T${timeValue}`);
                
                const { Manseryeok } = window.BIKUL_MANSERYEOK;
                const manseryeok = new Manseryeok(fullDateTime);
                
                const saju = manseryeok.getSaju();
                const daeun = manseryeok.getDaeun();

                sajuResultDiv.innerText = `${saju.getSiju().toString()} ${saju.getIlju().toString()} ${saju.getWolju().toString()} ${saju.getYeonju().toString()}`;
                
                let daeunText = '--- 대운 ---\n';
                daeun.forEach(d => {
                    daeunText += `${String(d.age).padStart(2, ' ')}세: ${d.ganji.toString()}\n`;
                });
                daeunResultDiv.innerText = daeunText;

                resultDiv.style.display = 'block';
            });
        });
    </script>
</body>
</html>
